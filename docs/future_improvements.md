# 未来改进与技术债

## 待解决问题

### 1. 生产环境图片上传显示问题

**问题描述:**
在开发环境 (`npm run dev`) 下，创建比赛时上传的图片可以在比赛页面上正常显示。然而，在生产环境 (`npm run build` 后 `npm start` 启动的项目) 中，新上传的图片无法显示。尽管图片已成功上传到服务器，且直接访问图片路径（例如 `https://yy.gameivy.com/uploads/covers/0297e3f6-1e8e-464e-9010-eda6ebd5382e.png`）可以正常打开，但只有在重新执行 `npm run build` 并启动服务后，这些新图片才能正常访问。

**原因分析:**
1.  **开发环境 (`npm run dev`):** Next.js 的开发服务器 (`next dev`) 具有动态文件处理能力。当新文件上传到 `public` 目录时，开发服务器会实时检测到文件系统的变化，并能够立即响应对这些新文件的请求。
2.  **生产环境 (`npm run build` & `npm start`):** `npm run build` 命令会生成一个静态的、优化过的生产版本应用。在构建过程中，所有在 `public` 目录中**已存在**的静态资源都会被打包和引用。`npm start` 启动的生产服务器是基于这次构建结果来运行的，它不会主动监控 `public` 目录中在构建之后新增的文件。因此，即使新上传的图片文件成功保存到了服务器的 `public/uploads/` 目录，当前运行的 Next.js 应用实例并不知道这些新文件的存在，导致无法正确提供访问。只有在下一次执行 `npm run build` 时，这些新文件才会被纳入到静态资源清单中，从而变得可访问。

**解决方案方向:**
*   考虑使用一个独立的静态文件服务（如 Nginx 或 Apache）来托管用户上传的图片，并配置 Next.js 应用通过 CDN 或直接 URL 访问这些图片，从而解耦应用构建与静态资源管理。
*   如果继续在 Next.js 应用内部托管，可能需要实现一个机制，在图片上传后通知应用（例如通过 API 刷新缓存或触发一个轻量级的重新加载），但这通常不推荐用于生产环境，因为这会增加复杂性并可能影响性能。更稳妥的方式是确保所有静态资源在构建时就已存在。
*   对于用户上传内容，最佳实践是将其存储在数据库或专门的对象存储服务（如 AWS S3、阿里云 OSS）中，并通过后端 API 提供访问，而不是直接作为 Next.js 的静态资源。
