## 数据库设计

*   **Users (用户表):** `id`, `username` (主办方账号), `password` (主办方密码), `game_id` (燕云十六声角色编号，唯一), `character_name` (燕云十六声角色名称，唯一), `phone_number` (可选), `role` (organizer, player), `stream_url` (TEXT, 主播直播间/主页地址，可选), `avatar` (TEXT, 默认 '000.webp'), `total_participations` (INTEGER, 默认 0), `first_place_count` (INTEGER, 默认 0), `second_place_count` (INTEGER, 默认 0), `third_place_count` (INTEGER, 默认 0), `forfeit_count` (INTEGER, 默认 0), `last_login_ip` (TEXT), `last_login_time` (TEXT), `login_count` (INTEGER, 默认 0), `uuid` (TEXT)
*   **Tournaments (比赛表):** `id`, `name`, `organizer_id`, `start_time`, `registration_deadline` (报名截止时间), `min_players`, `max_players` (最大48), `status` (pending, registration_closed, ongoing, finished, failed, extended_registration), `prize_settings` (TEXT, JSON string for prize allocation), `event_description` (TEXT), `wechat_qr_code_url` (TEXT，存储图片URL，可选), `cover_image_url` (TEXT, 默认 'default_cover.jpg'), `room_name` (TEXT), `room_number` (TEXT，10位数字), `room_password` (TEXT，4位数字，可选), `livestream_url` (TEXT, 直播间地址，可选), `registration_code` (TEXT, 参赛验证码，可选), `winner_id`, `default_match_format` (TEXT), `final_rankings` (TEXT), `view_count` (INTEGER, 默认 0)
*   **Prizes (奖品表):** `id`, `name` (唯一), `description`, `image_url`
    *   默认奖品列表：八音窍、2580长鸣珠时装、1280长鸣珠时装/武学特效/坐骑、980长鸣珠奇术特效、680长鸣珠时装/武器外观/坐骑、60长鸣珠时装/武器外观/坐骑、128元典藏战令、68元精英战令、30元月卡。
*   **TournamentPrizes (比赛奖品表):** `id`, `tournament_id` (外键), `prize_id` (外键, 可为空), `rank_start` (名次开始), `rank_end` (名次结束), `custom_prize_name` (自定义奖品名), `quantity` (数量)。
*   **PlayerAwards (玩家获奖表):** `id`, `tournament_id` (外键), `player_id` (外键), `prize_id` (外键), `awarded_at` (发放时间), `remark` (TEXT), UNIQUE(tournament_id, player_id)。
*   **Registrations (报名表):** `id`, `tournament_id`, `player_id`, `character_name`, `character_id`, `registration_time` (报名时间), `status` (active, withdrawn, forfeited), UNIQUE (tournament_id, player_id)
    *   **退出报名处理:** 玩家退出报名时，将 `status` 字段从 `active` 更新为 `withdrawn`，而不是删除记录。如果系统已完成对战分组，则此玩家视为弃权，`status` 更新为 `forfeited`。
*   **Matches (对阵表):** `id`, `tournament_id`, `round_number`, `player1_id`, `player2_id`, `winner_id`, `status` (pending, finished, forfeited), `finished_at` (TEXT), `match_format` (TEXT)
    *   **`status` 字段新增 `forfeited` 状态，用于标记双方弃权的比赛。**