# 项目：1v1竞技比赛管理平台

## 1. 项目概述

本项目旨在创建一个管理玩家1v1竞技比赛的平台。平台服务于两类主要用户：比赛主办者和参赛玩家。真实比赛将在主办者创建的**燕云十六声砺兵台房间**中进行。当前版本主要支持**1v1个人赛**，暂不支持5v5团队赛（后期版本可考虑增加，项目设计需注意兼容性）。系统将自动化处理部分流程，如比赛匹配和报名限制，同时赋予主办者管理比赛进程的关键权限。

## 2. 用户角色

*   **比赛主办者 (Organizer):**
    *   可以创建、配置和管理一场完整的比赛。
    *   负责在每轮比赛后指定获胜者。
    *   **注册与登录:** 需提供账号密码，同时绑定个人**燕云十六声角色编号**和**燕云十六声角色名称**（要求与玩家一致，数据自动保存到玩家表中）。注册后自动登录，网页除了显示其游戏角色名称外，还拥有创建和管理比赛的相关权限。
    *   **比赛管理权限:** 对已创建的比赛无删除权限，只允许修改资料。
    *   **直播间/主页地址:** 注册时可提供直播间地址（如 `https://live.douyin.com/813154277194`）或平台主页地址（如 `https://www.douyin.com/user/MS4wLjABAAAA...`），方便引导宣传。
    *   **组织者作为玩家:** 组织者在游戏中也是玩家，拥有玩家的全部权限。组织者登录后可以直接用自己的玩家身份报名符合条件的比赛，但**禁止报名自己组织的比赛**。组织者也可以和普通玩家一样直接用自己的玩家角色编号登录系统，以纯玩家的权限访问。
*   **玩家 (Player):**
    *   无需注册账号密码，只用输入自己的游戏ID即可参与。
    *   可以浏览和报名参加由主办者创建的比赛。
    *   **注册与登录:** 玩家输入**燕云十六声角色编号**进行注册。当系统内没有保存此编号时，提示用户补充其**燕云十六声角色名称**。数据会自动保存到系统。用户可选补充**手机号**管理游戏ID，游戏ID或手机号可作为用户账号。注册后自动登录，网页显示玩家角色名称。
    *   **参赛资格:** 报名成功后，必须用报名的角色参加比赛，奖品也只发放到对应ID的角色。
    *   **报名比赛:** 登录的玩家可以一键报名可报名的比赛，玩家可以同时报名多个比赛，且暂不做任何限制。
    *   **查看已报名比赛:** 玩家可以查看自己已报名的比赛列表。
    *   **退出报名:** 在比赛开始前可以退出报名，如果系统已完成对战分组，则此玩家视为弃权。
    *   **玩家升级为主办者:** 在系统中登记过的玩家，可以补充账号密码信息，注册成为比赛主办者。
*   **平台管理员 (Admin - Implied):**
    *   负责在后台配置和管理平台可选的奖品池。

## 3. 核心功能

### 3.1. 主办者功能

*   **创建比赛:**
    *   设置比赛的开始时间。
    *   设置最少参赛人数（硬性要求：不得少于10人）。
    *   设置最大参赛人数（**单次最大人数上限规定为48人**，因为砺兵台房间人数上限是50人）。
    *   **赛事说明:** 提供赛事说明文本框，让玩家了解参赛条件、比赛流程、注意事项等。
    *   **微信群二维码:** 提供一个微信群二维码**图片上传**功能，此项为非必填项。如果未填写，需要玩家在游戏中主动加主办者为好友参加比赛。
    *   **奖品设置:**
        *   默认提供第一名到第五名的奖品和数量设置。
        *   设置参与奖的奖品和数量（所有未获得名次奖品的参赛玩家）。
        *   奖品可以为“无”，例如只给第一名发奖，其他人无奖品。
        *   提供自定义奖项的奖品和数量设置，自定义奖不限制数量，可由主办者自己设置以取代固定奖项（例如：三到五名的奖品，五到十名的奖品，10到20名的奖品等）。
    *   **报名截止时间:** 必填项，如果不填默认为比赛开始时间。
    *   **砺兵台房间信息:** 在比赛开始前，主办者需补充填写自己创建的砺兵台房间名、房间号（10位数字）和房间密码（4位数字，如果没有密码为开放式房间）。
*   **管理比赛:**
    *   比赛开始后，可以查看对阵图。
    *   为每一组对局手动选择获胜者，以推进比赛进入下一轮。
    *   对已创建的比赛无删除权限，只允许修改资料。
    *   **活动组织失败处理:** 如果报名截止时已报名比赛玩家未达最少参赛人数设置，视为活动组织失败，由主办者决定关闭比赛（状态为“已关闭”）或延长报名时间调整比赛日期（状态可以为“报名中”或“延期报名中”）。
    *   **获胜者标记:** 主办者要能方便快捷地标记分组中的获胜玩家。

### 3.2. 玩家功能

*   **报名参赛:**
    *   在比赛报名截止前，可以报名参加。
    *   报名时必须提供以下信息：
        *   **燕云十六声角色编号 (10位数字UID):** 唯一的数字ID，**不得重复**。
        *   **燕云十六声角色名称:** **不得重复**。
        *   **手机号:** 可选补充，用于管理游戏ID。

### 3.3. 系统自动化逻辑

*   **比赛规则自动配置:**
    *   系统会根据最终参赛人数，自动配置最合适的比赛赛制（例如，1局1胜、3局2胜）。
    *   **特殊规则:** 冠军赛（决赛）必须为5局3胜制。
    *   **赛制建议:** 平台可根据报名分组给出建议的赛制，例如48进24推荐一局一胜，12进6推荐三局二胜，决赛推荐五局三胜。同一场比赛可以有不同的赛制。
    *   **砺兵台挑战模式:** 房间挑战模式必须设置为管理模式，由主办者根据网站生成的1v1分组选择成员上场。
*   **报名与匹配:**
    *   当报名人数达到主办者设置的“最少参赛人数”后，系统自动开始生成对阵图，比赛正式开始。
    *   当报名人数达到“最大参赛人数”后，系统自动关闭报名通道。
*   **晋级流程:**
    *   主办者选定胜者后，系统自动将胜者匹配到下一轮比赛，直到决出最终冠军。当出现冠军后，比赛状态自动改为“已结束”。
*   **比赛状态流转:**
    *   创建比赛后状态为“待定”。
    *   报名截止时间后，如果达到最少人数，状态变为“报名已结束”。
    *   当到达主办者设置的比赛时间后，比赛状态为“进行中”。
    *   当出现冠军后，自动改状态为“已结束”。

### 3.4. 网站首页展示

*   **赛事列表:** 网站首页为赛事列表，显示以下类型的比赛：
    *   **正在进行中的比赛:** 报名已结束，正在比赛中。除了显示比赛信息，还要显示直播间地址和燕云十六声砺兵台房间号。玩家可在游戏中搜索房间号进入观战（前提是房间人数未超过50人且房间未设置密码或主办者填写了密码）。
    *   **即将开始的比赛:** 包括报名中和报名已结束但还未到比赛时间的比赛。
    *   **已经结束的比赛。**

### 3.5. 比赛详情页

*   **玩家分组状态:** 显示比赛匹配的玩家分组状态。
*   **获胜者设置:** 正在进行中的比赛要由主办者设置每组获胜者玩家。
*   **玩家信息显示:** 玩家信息只公开显示角色名称，角色编号只公开显示前3位和最后3位。

### 3.6. 奖品管理

*   **奖品列表:** 包括系统默认设置的奖品，也可以由主办者自己定义奖品。
*   **自定义奖品:** 主办者自定义的奖品仅主办者自己可选，系统设置奖品为所有比赛公用。

## 4. 数据库设计草案

*   **Users (用户表):** `id`, `username` (主办者账号), `password` (主办者密码), `game_id` (燕云十六声角色编号，唯一), `character_name` (燕云十六声角色名称，唯一), `phone_number` (可选), `role` (organizer, player), `stream_url` (TEXT, 主播直播间/主页地址，可选)
*   **Tournaments (比赛表):** `id`, `name`, `organizer_id`, `start_time`, `registration_deadline` (报名截止时间), `min_players`, `max_players` (最大48), `status` (pending, registration_closed, ongoing, finished, failed, extended_registration), `prize_settings` (TEXT/JSONB存储奖品分配), `event_description` (TEXT), `wechat_qr_code_url` (TEXT，存储图片URL，可选), `room_name` (TEXT), `room_number` (TEXT，10位数字), `room_password` (TEXT，4位数字，可选), `winner_id`
*   **Prizes (奖品表):** `id`, `name`, `description`, `image_url`
    *   默认奖品列表：八音窍、2680长鸣珠时装、1280长鸣珠时装/武学特效/坐骑、980长鸣珠奇术特效、680长鸣珠时装/武器外观/坐骑、60长鸣珠时装/武器外观/坐骑、128元典藏战令、68元精英战令、30元月卡。
*   **Registrations (报名表):** `id`, `tournament_id`, `player_id`, `character_name`, `character_id`, `registration_time` (报名时间), `status` (active, withdrawn, forfeited)
    *   **退出报名处理:** 玩家退出报名时，将 `status` 字段从 `active` 更新为 `withdrawn`，而不是删除记录。如果系统已完成对战分组，则此玩家视为弃权，`status` 更新为 `forfeited`。
*   **Matches (对阵表):** `id`, `tournament_id`, `round_number`, `player1_id`, `player2_id`, `winner_id`, `status` (pending, finished)

## 5. 开发计划

1.  **项目初始化:** 设置技术栈（例如 Node.js + Express + a database）。
2.  **数据库设计:** 细化并创建数据库表结构。
3.  **API开发:** 开发后端API接口，实现所有核心功能。
4.  **前端开发:** 创建用户界面，供主办者和玩家使用。
5.  **测试与部署:** 进行功能测试并部署上线。

## 6. 开发流程/规范

*   **版本控制:** 项目使用Git进行管理。
    *   **提交规范:** 每开发完成一个功能模块并由用户测试确认无误后，我会与用户确认是否提交git commit。如果用户认可，将使用 `git commit -F` 的方式把当前开发完成的代码提交。